$def with (works, key, loans=None, waitlists=None, reading_log=None, lists=None, loan_history=None)

$ title = key.title().replace('-', ' ')

<div id="contentHead">
  <div id="mybooks">
    <h1>$title</h1>
    <div class="mybooks">
      <div class="mybooks-menu">
        <ul class="loans-lists">
          <li class="subsection">Loans</li>
          <li><a href="/account/my-books/loans" $('class="selected"' if key == 'loans' else '') href="">Active Loans ($(len(loans) or 0)/5)</a></li>
          <li><a href="/account/my-books/waitlists" $('class="selected"' if key == 'waitlists' else '')>Waitlists ($(len(waitlists) or 0))</a></li>
          $if loan_history:
            <li><a href="/account/my-books/loan-history" $('class="selected"' if key == 'loan-history' else '')>Loan History (46)</a></li>
        </ul>
        <ul class="preset-lists">
          <li class="subsection">Reading Log</li>
          <li><a href="/account/my-books/currently-reading" $('class="selected"' if key == 'currently-reading' else '')>Currently Reading ($(reading_log['currently-reading']))</a></li>
          <li><a href="/account/my-books/want-to-read" $('class="selected"' if key == 'want-to-read' else '')>Want to Read ($(reading_log['want-to-read']))</a></li>
          <li><a href="/account/my-books/already-read" $('class="selected"' if key == 'already-read' else '')>Already Read ($(reading_log['already-read']))</a></li>
        </ul>
        $if lists:
          <ul class="user-lists">
            <li class="subsection">Lists</li>
            <div class="list-overflow">
              $for lst in lists:
                <li><a class="list-link" href="$(lst.key)">$lst['name'] ($(len(lst.seeds)))</a></li>
            </div>
          </ul>
      </div>
      <div class="mybooks-list">
        <ul class="list-books" id="siteSearch">
          $if works:
            $ bookshelf_id = 1 if key == 'want-to-read' else 2 if key == 'currently-reading' else 3 if key == 'already-read' else None
            $for work in works:
              $if work.get('type') == '/type/loan':
                $:macros.loan_item(work)
              $else:
                $ decorations = macros.ReadingLogButton(work, read_status=bookshelf_id) if bookshelf_id else None
                $:macros.SearchResultsWork(work, decorations=decorations)
          $else:
            <li>No books are on this shelf</li>
        </ul>
        $if len(works) > 100:
          <div class="loadmore">
            <button>Load more</button>
          </div>
      </div>
      <div class="mybooks-list-options">
        <h3>About this list</h3>
        <p>Export, subscribe, etc.</p>
      </div>
    </div>
  </div>
</div>
